/*bpm1.0.0b|WTFPL*/// bpm.js
// Version - 1.0.0b
//
// by
// Jonathan Azoff - @azoff - jon[at]azoffdesign.com
//
// http://azoff.github.com/bpm
// https://github.com/azoff/bpm/
//
// Tri-license - WTFPL | MIT | BSD
(function(a,b){function f(a,b){if(a==b)return 0;var c=a.length,d=b.length;if(c===0)return d;if(d===0)return c;var e=!1;try{e=!"0"[0]}catch(f){e=!0}e&&(a=a.split(""),b=b.split(""));var g=new Array(c+1),h=new Array(c+1),i=0,j=0,k=0;for(i=0;i<c+1;i++)g[i]=i;var l="",m="";for(j=1;j<=d;j++){h[0]=j,m=b[j-1];for(i=0;i<c;i++){l=a[i],k=l==m?0:1;var n=g[i+1]+1,o=h[i]+1,p=g[i]+k;o<n&&(n=o),p<n&&(n=p),h[i+1]=n}var q=g;g=h,h=q}return g[c]}var c=Array.prototype,d=Object.prototype,e=a.bpm={_manifest:{},_db:{count:0,keys:[],definitions:{}},repository:"http://azoff.github.com/bpm/packages.min.js",mode:"prod",logging:!1,init:function(a){e.initialized||(a?(e.utils.info("Definitions received, parsing..."),e.utils.each(a,function(a,b){e.define(b,a)}),e.utils.info("Parsing complete, ${count} definitions loaded.",{count:e._db.count}),e.initialized=!0,e.ready.list&&e.utils.each(e.ready.list,function(a){a(e)})):(e.utils.info("Starting BPM, loading definitions from ${repo}...",{repo:e.repository}),e.load(e.repository)))},ready:function(a){e.initialized?a(e):e.ready.list?e.ready.list.push(a):e.ready.list=[a]},install:function(a,b){var c=[],d,f=!0,g=function(){e.utils.info("Script(s) successfully loaded, installation complete!"),b&&b.call&&b()};e.ready(function(){e.utils.info("Processing install request..."),e.utils.each(e.utils.ensureArray(a),d=function(a){var b=e.search(a),g;e.utils.info('Creating manifest entry for "${key}" @ "${version}"...',b);if(!b.keyMatch)return f=e.utils.error('Unable to find definition for "${key}", did you mean "${suggestion}"?',{key:b.key,suggestion:e.suggest(b.key)});if(!b.versionMatch)return f=e.utils.error('Found definition for "${key}", but could not find version "${version}". Available versions: ${versions}',{key:b.key,version:b.version,versions:e.versions(b.key).join(", ")});e.utils.each(e.requires(b.key),d);if(!f)return!1;if(b.key in e._manifest)e._manifest[b.key]!==b.version?e.utils.error('WARNING: detected request for version "${version}" of "${key}" which conflicts with previously requested version "${previous}"! Ignoring request...',{key:b.key,version:b.version,previous:e._manifest[b.key]}):e.utils.info('"${key}" already in manifest, skipping...',b);else{g=e.url(b.key,b.version);if(!g)return f=e.utils.error('Found definition for "${key}", but could not find CDN URL for "${mode}" mode. Available modes: ${modes}',{key:b.key,mode:e.mode,modes:e.utils.keys(e.lookup(b.key).cdn).join(", ")});e.utils.info('Manifest entry for "${key}" created, using: ${url}',{key:b.key,url:g}),e._manifest[b.key]=b.version,c.push(g)}}),f&&(c.length?(e.utils.info("Manifest created! Loading ${count} new script(s)...",{count:c.length}),e.load({load:c,complete:g})):(e.utils.info("No new scripts to add..."),g()))})},url:function(a,b){var c=e.lookup(a),f="";return c&&c.cdn&&(d.toString.call(c.cdn)==="[object String]"?f=e.utils.format(c.cdn,{v:b}):e.mode in c.cdn&&(f=e.utils.format(c.cdn[e.mode],{v:b}))),f},load:function(){var b=c.slice.call(arguments);yepnope.apply(a,b)},list:function(){return e.utils.info(e._db.keys.join(", ")),e._db.keys},manifest:function(){var a=[];return e.utils.each(e._manifest,function(b,c){var d=e.url(c,b);a.push(d),e.utils.info("${key}@${version} :: ${url}",{key:c,version:b,url:d})}),a},latest:function(a){var b=e.versions(a),c=b.length;return c>0?b[c-1]:""},versions:function(a){var b=e.lookup(a);return b&&b.versions?b.versions:[]},requires:function(a){var b=e.lookup(a);return b&&b.requires?b.requires:[]},search:function(a){var b={keyMatch:!1,versionMatch:!1,key:a.key||a,version:a.version||"latest"},c;return b.keyMatch=!!e.lookup(b.key),b.keyMatch&&(c=e.versions(b.key),c.length===0?b.versionMatch=b.version==="latest":b.version==="latest"?(b.version=c[c.length-1],b.versionMatch=!0):b.versionMatch=c.indexOf(b.version)>=0),b},suggest:function(a){return e._db.keys.sort(function(b,c){var d=f(a,b),e=f(a,c);return d===e?0:d>e?1:-1})[0]},lookup:function(a){return a in this._db.definitions?this._db.definitions[a]:null},define:function(a,b){e.lookup(a)||(this._db.keys.push(a),this._db.count++),this._db.definitions[a]=b},utils:{ensureArray:function(a){return d.toString.call(a)==="[object Array]"?a:[a]},each:function(a,b,d){var e=c.forEach;if(a===null)return;if(e&&a.forEach===e)a.forEach(b,d);else if(a.length===+a.length){for(var f=0,g=a.length;f<g;f++)if(f in a&&b.call(d,a[f],f,a)===!1)return}else for(var h in a)if(h in a&&b.call(d,a[h],h,a)===!1)return},format:function(a,b){return b?a.replace(/\$\{(.*?)\}/g,function(a,c){return c in b?b[c]:""}):a},info:function(a,c){b&&e.logging&&b.info(e.utils.format(a,c))},error:function(a,c){return b&&e.logging&&b.error(e.utils.format(a,c)),!1},keys:function(a){return(Object.keys||function(a){var b=[],c;for(c in a)c in a&&b.push(k);return b})(a)}}};(function(a,b,c){function B(a){return!a||a=="loaded"||a=="complete"||a=="uninitialized"}function C(a,c,d,g,h,i){var k=b.createElement("script"),l,m;g=g||A.errorTimeout,k.src=a;for(m in d)k.setAttribute(m,d[m]);c=i?E:c||j,k.onreadystatechange=k.onload=function(){!l&&B(k.readyState)&&(l=1,c(),k.onload=k.onreadystatechange=null)},e(function(){l||(l=1,c(1))},g),h?k.onload():f.parentNode.insertBefore(k,f)}function D(a,c,d,g,h,i){var k=b.createElement("link"),l,m;g=g||A.errorTimeout,c=i?E:c||j,k.href=a,k.rel="stylesheet",k.type="text/css";for(m in d)k.setAttribute(m,d[m]);h||(f.parentNode.insertBefore(k,f),e(c,0))}function E(){var a=h.shift();i=1,a?a.t?e(function(){(a.t=="c"?A.injectCss:A.injectJs)(a.s,0,a.a,a.x,a.e,1)},0):(a(),E()):i=0}function F(a,c,d,g,j,k,n){function s(b){if(!p&&B(o.readyState)){r.r=p=1,i||E(),o.onload=o.onreadystatechange=null;if(b){a=="object"&&e(function(){m.removeChild(o)},50);for(var d in x[c])x[c].hasOwnProperty(d)&&x[c][d].onload()}}}n=n||A.errorTimeout;var o={},p=0,q=0,r={t:d,s:c,e:j,a:k,x:n};x[c]===1&&(q=1,x[c]=[],o=b.createElement(a)),o.src=o.data=c,o.width=o.height="0",o.onerror=o.onload=o.onreadystatechange=function(){s.call(this,q)},h.splice(g,0,r),a=="object"&&(q||x[c]===2?(m.insertBefore(o,l?null:f),e(s,n)):x[c].push(o))}function G(a,b,c,d,e){return i=0,b=b||"j",u(a)?F(b=="c"?r:q,a,b,this.i++,c,d,e):(h.splice(this.i++,0,a),h.length===1&&E()),this}function H(){var a=A;return a.loader={load:G,i:0},a}var d=b.documentElement,e=a.setTimeout,f=b.getElementsByTagName("script")[0],g={}.toString,h=[],i=0,j=function(){},k="MozAppearance"in d.style,l=k&&!!b.createRange().compareNode,m=l?d:f.parentNode,n=a.opera&&g.call(a.opera)=="[object Opera]",o=!!b.attachEvent,p="webkitAppearance"in d.style,q=k?"object":"img",r=o?"script":q,s=Array.isArray||function(a){return g.call(a)=="[object Array]"},t=function(a){return Object(a)===a},u=function(a){return typeof a=="string"},v=function(a){return g.call(a)=="[object Function]"},w=[],x={},y={timeout:function(a,b){return b.length&&(a.timeout=b[0]),a}},z,A;A=function(a){function f(a){var b=a.split("!"),c=w.length,d=b.pop(),e=b.length,f={url:d,origUrl:d,prefixes:b},g,h,i;for(h=0;h<e;h++)i=b[h].split("="),g=y[i.shift()],g&&(f=g(f,i));for(h=0;h<c;h++)f=w[h](f);return f}function g(a){return a.split(".").pop().split("?").shift()}function h(a,b,d,e,h){var i=f(a),j=i.autoCallback,k=g(i.url);if(i.bypass)return;b&&(b=v(b)?b:b[a]||b[e]||b[a.split("/").pop().split("?")[0]]||E);if(i.instead)return i.instead(a,b,d,e,h);x[i.url]?i.noexec=!0:x[i.url]=1,d.load(i.url,i.forceCSS||!i.forceJS&&"css"==g(i.url)?"c":c,i.noexec,i.attrs,i.timeout),(v(b)||v(j))&&d.load(function(){H(),b&&b(i.origUrl,h,e),j&&j(i.origUrl,h,e),x[i.url]=2})}function i(a,b){function m(a,d){var e;if(!a)d||i();else if(u(a))d||(f=function(){var a=[].slice.call(arguments);g.apply(this,a),i()}),h(a,f,b,0,c);else if(t(a)){k=function(){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b}();for(e in a)a.hasOwnProperty(e)&&(!d&&!--k&&(v(f)?f=function(){var a=[].slice.call(arguments);g.apply(this,a),i()}:f[e]=function(a){return function(){var b=[].slice.call(arguments);a.apply(this,b),i()}}(g[e])),h(a[e],f,b,e,c))}}var c=!!a.test,d=c?a.yep:a.nope,e=a.load||a.both,f=a.callback||j,g=f,i=a.complete||j,k,l;m(d,!!e),e&&m(e)}var b,d,e=this.yepnope.loader;if(u(a))h(a,0,e,0);else if(s(a))for(b=0;b<a.length;b++)d=a[b],u(d)?h(d,0,e,0):s(d)?A(d):t(d)&&i(d,e);else t(a)&&i(a,e)},A.addPrefix=function(a,b){y[a]=b},A.addFilter=function(a){w.push(a)},A.errorTimeout=1e4,b.readyState===null&&b.addEventListener&&(b.readyState="loading",b.addEventListener("DOMContentLoaded",z=function(){b.removeEventListener("DOMContentLoaded",z,0),b.readyState="complete"},0)),a.yepnope=H(),a.yepnope.executeStack=E,a.yepnope.injectJs=C,a.yepnope.injectCss=D})(a,a.document),e.init()})(this,this.console);
